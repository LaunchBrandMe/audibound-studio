<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kokoro Playground</title>
    <link rel="stylesheet" href="/static/styles.css">
    <style>
        /* Dark Mode Support */
        body.voice-page.light-mode {
            --bg: #FFF7EC;
            --bg-alt: #ffffff;
            --card: #ffffff;
            --border: #e5d4c1;
            --border-strong: rgba(168, 58, 250, 0.4);
            --text: #121A2F;
            --muted: #5a6478;
            --primary: #A83AFA;
            --accent: #FF2FAD;
            background: linear-gradient(to bottom, #FFF7EC, #ffffff);
        }

        .top-nav {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--card);
            border-bottom: 1px solid var(--border);
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .top-nav-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text);
            text-decoration: none;
        }

        .logo span {
            margin-bottom: -7px;
        }

        .logo img {
            height: 32px;
        }

        .top-nav-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dark-mode-toggle {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s ease;
            color: var(--text);
        }

        .dark-mode-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .burger-menu {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s ease;
            color: var(--text);
        }

        .burger-menu:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .menu-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 24px;
            margin-top: 8px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            min-width: 220px;
            z-index: 1000;
        }

        .menu-dropdown.active {
            display: block;
        }

        .menu-dropdown a {
            display: block;
            padding: 12px 16px;
            color: var(--text);
            text-decoration: none;
            transition: background 0.2s ease;
            font-size: 0.95rem;
        }

        .menu-dropdown a:first-child {
            border-radius: 12px 12px 0 0;
        }

        .menu-dropdown a:last-child {
            border-radius: 0 0 12px 12px;
        }

        .menu-dropdown a:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .menu-dropdown a:not(:last-child) {
            border-bottom: 1px solid var(--border);
        }

        /* Enhanced Sesame Playground Styles */
        .voice-select-container {
            margin-bottom: 24px;
        }

        .voice-select-container label {
            display: block;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.08em;
            color: var(--muted);
            margin-bottom: 8px;
            font-weight: 600;
        }

        #voice-select {
            width: 100%;
            margin-bottom: 12px;
        }

        .token-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .token-btn {
            padding: 12px 16px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.12), rgba(5, 150, 105, 0.08));
            border: 1px solid rgba(16, 185, 129, 0.25);
            border-radius: 10px;
            color: var(--text);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            text-align: center;
        }

        .token-btn:hover {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.12));
            border-color: rgba(16, 185, 129, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
        }

        .token-btn:active {
            transform: translateY(0);
        }

        #prompt {
            width: 100%;
            min-height: 160px;
            font-size: 1rem;
            line-height: 1.7;
            resize: vertical;
            margin-bottom: 16px;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .action-buttons button {
            flex: 1;
            padding: 14px 20px;
            font-size: 1rem;
            font-weight: 600;
        }

        .action-buttons .secondary-btn {
            flex: 0 0 140px;
        }

        .status {
            min-height: 28px;
            color: var(--primary);
            font-size: 0.95rem;
            margin-bottom: 12px;
            font-weight: 500;
        }

        #preview {
            width: 100%;
            margin-top: 8px;
            border-radius: 12px;
            background: var(--bg-alt);
        }

        .help-text {
            background: rgba(16, 185, 129, 0.08);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 12px;
            padding: 16px;
            margin-top: 24px;
        }

        .help-text h3 {
            margin: 0 0 12px 0;
            font-size: 1.1rem;
            color: var(--text);
        }

        .help-text ul {
            margin: 0;
            padding-left: 20px;
            color: var(--muted);
            line-height: 1.7;
        }

        .help-text code {
            background: rgba(16, 185, 129, 0.15);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
            font-family: 'SF Mono', Consolas, monospace;
        }

        /* Modern select dropdown styling */
        #voice-select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1.5L6 6.5L11 1.5" stroke="%23ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 40px;
        }

        /* Light mode fixes */
        body.voice-page.light-mode #voice-select,
        body.voice-page.light-mode #prompt {
            background: #ffffff;
            color: var(--text);
            border: 1px solid var(--border);
        }

        body.voice-page.light-mode #voice-select {
            background-image: url('data:image/svg+xml;utf8,<svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1.5L6 6.5L11 1.5" stroke="%236b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>');
        }

        body.voice-page.light-mode #prompt::placeholder {
            color: var(--muted);
        }
    </style>
</head>

<body class="voice-page">
    <div class="top-nav">
        <div class="top-nav-left">
            <a href="/" class="logo">
                <img src="/static/logo.png" alt="Audibound Studio">
                <span>Studio</span>
            </a>
        </div>
        <div class="top-nav-actions">
            <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Toggle dark mode">üåô</button>
            <button class="burger-menu" onclick="toggleMenu()" title="Menu">‚ò∞</button>
            <div id="menu-dropdown" class="menu-dropdown">
                <a href="/">‚Üê Back to Projects</a>
                <a href="/static/cost_analytics.html">üí∞ Cost Analytics</a>
                <a href="/static/voices.html">üéôÔ∏è Voice & Cloning Lab</a>
                <a href="/static/sfx_playground.html">üîä SFX & Music</a>
                <a href="/static/sesame_playground.html">üå± Sesame Playground</a>
                <a href="/static/kokoro_playground.html">üé§ Kokoro Playground</a>
                <a href="/static/styletts2_playground.html">üé≠ StyleTTS2 Playground</a>
                <a href="/static/indextts2_playground.html">üì° IndexTTS2 Playground</a>
                <a href="/static/dia_playground.html">üíé Dia Playground</a>
                <a href="/static/multitrack_player.html">‚ñ∂ Multi-Track Player</a>
            </div>
        </div>
    </div>

    <div class="page-shell">
        <header style="margin-bottom: 32px;">
            <h1 style="margin: 0; font-size: clamp(1.9rem, 2.5vw, 2.6rem);">üé§ Kokoro Playground</h1>
            <p style="margin: 8px 0 0 0; color: var(--muted); font-size: 1.05rem;">Fast multi-voice TTS with natural
                speech patterns and expressive delivery.</p>
        </header>

        <div class="card voice-select-container">
            <label for="voice-select">Reference Voice</label>
            <select id="voice-select">
                <option value="">Use base Kokoro voice</option>
            </select>
            <button class="secondary-btn" onclick="refreshVoices()" style="margin-top:8px;">üîÑ Refresh Voices</button>
        </div>

        <div class="card">
            <h3 style="margin: 0 0 16px 0; font-size: 1.15rem; color: var(--text);">Voice & Style Controls</h3>
            <div class="token-grid">
                <button class="token-btn" onclick="insertToken('[neutral]')">üòê Neutral</button>
                <button class="token-btn" onclick="insertToken('[happy]')">üòä Happy</button>
                <button class="token-btn" onclick="insertToken('[sad]')">üò¢ Sad</button>
                <button class="token-btn" onclick="insertToken('[angry]')">üò† Angry</button>
                <button class="token-btn" onclick="insertToken('[excited]')">ü§© Excited</button>
                <button class="token-btn" onclick="insertToken('[calm]')">üòå Calm</button>
                <button class="token-btn" onclick="insertToken('[whisper]')">ü§´ Whisper</button>
                <button class="token-btn" onclick="insertToken('[pause 1s]')">‚è∏Ô∏è Pause 1s</button>
            </div>

            <label for="prompt"
                style="display: block; font-size: 0.9rem; color: var(--muted); margin-bottom: 8px; font-weight: 600;">Your
                Script</label>
            <textarea id="prompt"
                placeholder="[neutral] Hello there. You can change my emotional tone with style tags.">Hello! This is a test of the Kokoro voice engine.</textarea>

            <div id="text-stats"
                style="font-size: 0.85rem; color: var(--muted); margin: 8px 0; font-family: monospace;">
                <span id="char-count">0 characters</span> ‚Ä¢ <span id="word-count">0 words</span> ‚Ä¢ <span id="cost-est"
                    style="color: #10b981; font-weight: 600;">üí∞ $0.000</span>
            </div>

            <div class="action-buttons">
                <button class="primary-btn" onclick="generateAudio()">üéôÔ∏è Generate Audio</button>
                <button class="secondary-btn" onclick="stopPlayback()">‚èπÔ∏è Stop</button>
            </div>

            <div id="status" class="status"></div>
            <audio id="preview" controls></audio>

            <div class="help-text">
                <h3>üìò Quick Reference</h3>
                <ul>
                    <li>Insert style tags like <code>[happy]</code>, <code>[whisper]</code> to change emotional tone
                    </li>
                    <li>Use <code>[pause 2s]</code> to add silence (1-5 seconds)</li>
                    <li>Kokoro supports fast, natural multi-voice generation</li>
                    <li>Select different voices from the dropdown for character variety</li>
                </ul>
            </div>
        </div>

    </div>

    <script>
        // Menu toggle
        function toggleMenu() {
            const menu = document.getElementById('menu-dropdown');
            menu.classList.toggle('active');
        }

        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
            const menu = document.getElementById('menu-dropdown');
            const burgerBtn = document.querySelector('.burger-menu');
            if (menu && !menu.contains(e.target) && e.target !== burgerBtn) {
                menu.classList.remove('active');
            }
        });

        // Dark mode functions
        function toggleDarkMode() {
            document.body.classList.toggle('light-mode');
            const isLight = document.body.classList.contains('light-mode');
            localStorage.setItem('darkMode', isLight ? 'disabled' : 'enabled');

            const toggle = document.querySelector('.dark-mode-toggle');
            toggle.textContent = isLight ? 'üåô' : '‚òÄÔ∏è';
        }

        function initDarkMode() {
            const darkMode = localStorage.getItem('darkMode');
            if (darkMode === 'disabled') {
                document.body.classList.add('light-mode');
                const toggle = document.querySelector('.dark-mode-toggle');
                if (toggle) toggle.textContent = 'üåô';
            } else {
                const toggle = document.querySelector('.dark-mode-toggle');
                if (toggle) toggle.textContent = '‚òÄÔ∏è';
            }
        }

        // Initialize dark mode
        initDarkMode();

    </script>
    <script>
        const API_URL = '';
        const voiceSelect = document.getElementById('voice-select');
        const promptBox = document.getElementById('prompt');
        const statusBox = document.getElementById('status');
        const audioEl = document.getElementById('preview');
        let currentAbort = null;

        async function refreshVoices() {
            try {
                const res = await fetch(`${API_URL}/voices`);
                const data = await res.json();
                const voices = data.voices || [];
                voiceSelect.innerHTML = '<option value="">Use base Sesame voice</option>';
                voices.filter(v => (v.engine || '').toLowerCase() === 'kokoro')
                    .forEach(v => {
                        const opt = document.createElement('option');
                        opt.value = v.id;
                        opt.textContent = v.name || v.id;
                        voiceSelect.appendChild(opt);
                    });
            } catch (err) {
                console.error(err);
                statusBox.textContent = 'Failed to load voices.';
            }
        }

        function insertToken(token) {
            const start = promptBox.selectionStart;
            const end = promptBox.selectionEnd;
            const value = promptBox.value;
            promptBox.value = value.slice(0, start) + token + value.slice(end);
            promptBox.focus();
            promptBox.selectionStart = promptBox.selectionEnd = start + token.length;
        }

        function stopPlayback() {
            if (currentAbort) {
                currentAbort.abort();
                currentAbort = null;
            }
            audioEl.pause();
            audioEl.currentTime = 0;
            statusBox.textContent = 'Playback stopped.';
        }

        async function generateAudio() {
            const text = promptBox.value.trim();
            if (!text) {
                alert('Enter some text first.');
                return;
            }
            stopPlayback();
            statusBox.textContent = 'Generating...';
            const controller = new AbortController();
            currentAbort = controller;
            try {
                const response = await fetch(`${API_URL}/playground/kokoro/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text, voice_id: voiceSelect.value || null }),
                    signal: controller.signal
                });
                if (!response.ok) {
                    const err = await response.json().catch(() => ({}));
                    throw new Error(err.detail || 'Failed to generate audio');
                }
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                audioEl.src = url;
                audioEl.play();
                statusBox.textContent = 'Preview ready.';
            } catch (err) {
                if (err.name === 'AbortError') {
                    statusBox.textContent = 'Request canceled.';
                } else {
                    statusBox.textContent = `Error: ${err.message}`;
                }
            } finally {
                currentAbort = null;
            }
        }

        refreshVoices();

        // Update text stats on input
        promptBox.addEventListener('input', () => {
            const text = promptBox.value;
            const charCount = text.length;
            const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;

            document.getElementById('char-count').textContent = `${charCount} character${charCount !== 1 ? 's' : ''}`;
            document.getElementById('word-count').textContent = `${wordCount} word${wordCount !== 1 ? 's' : ''}`;

            // Calculate cost (Kokoro: $0.01-$0.02 per 1k chars)
            const minCost = (charCount / 1000) * 0.01;
            const maxCost = (charCount / 1000) * 0.02;
            const costText = minCost === maxCost ? `$${minCost.toFixed(3)}` : `$${minCost.toFixed(3)}-$${maxCost.toFixed(3)}`;
            document.getElementById('cost-est').textContent = `üí∞ ${costText}`;

            console.log(`[Kokoro] Text stats - Characters: ${charCount}, Words: ${wordCount}, Est cost: ${costText}`);
        });

        // Trigger initial count
        promptBox.dispatchEvent(new Event('input'));
    </script>
</body>

</html>